"""
Шаблоны промптов для генерации датасета анонимизации ПД
"""

MAIN_PROMPT_TEMPLATE = """
# ЗАДАЧА: Генерация датасета для тестирования анонимизации персональных данных в русской речи

## ПАРАМЕТРЫ ГЕНЕРАЦИИ
- **Количество диалогов**: {total_dialogs}
- **Сфера деятельности**: {business_sphere}
- **Региональный фокус**: {regional_focus}
- **Качество транскрибации**: {transcription_quality}
- **Стиль общения**: {communication_style}

## КОНТЕКСТ
Создай {total_dialogs} разнообразных транскрибированных телефонных диалогов в сфере "{business_sphere}" между покупателем и продавцом/менеджером в регионе "{regional_focus}". Диалоги должны имитировать реальные разговоры с естественным упоминанием персональных данных.

## СТРУКТУРА ДАТАСЕТА
- **Общий объем**: {total_dialogs} диалогов
- **С персональными данными**: {pd_percentage}% (примерно {pd_count} диалогов)  
- **Без персональных данных**: {no_pd_percentage}% (примерно {no_pd_count} диалогов)
- **Ложные срабатывания**: включить в {false_positive_percentage}% диалогов

## ТИПЫ ПЕРСОНАЛЬНЫХ ДАННЫХ ДЛЯ ВКЛЮЧЕНИЯ

### 1. БАЗОВЫЕ ПД
- **ФИО**: полные имена, сокращенные (И.О. Петров, Иван П.), уменьшительные (Ваня, Катя), с отчествами и без
- **Телефоны**: +7, 8, без кода, с разными разделителями, частично замаскированные, региональные коды
- **Email**: различные домены (.ru, .com, .mail.ru, yandex.ru, gmail.com, корпоративные)
- **Возраст**: "мне 25", "25-летний", "родился в 85-м", "пенсионер", "школьник"

### 2. АДРЕСНЫЕ ДАННЫЕ
- **Полные адреса**: с индексами, без индексов, разные форматы, {regional_focus} специфика
- **Частичные адреса**: районы, улицы, микрорайоны региона {regional_focus}
- **Ориентиры**: метро, остановки, торговые центры, школы, больницы {regional_focus}

### 3. ДОКУМЕНТЫ
- **Паспорта**: серия/номер в разных форматах, региональные серии {regional_focus}
- **СНИЛС**: с дефисами и без, старые и новые форматы
- **ИНН**: физлиц и юрлиц, региональные коды {regional_focus}
- **Водительские права**: разные категории
- **Полисы ОМС**: старые и новые форматы

### 4. ФИНАНСОВЫЕ ДАННЫЕ
- **Номера карт**: Visa, MasterCard, МИР, частично скрытые
- **Банковские счета**: расчетные, карточные, корпоративные
- **Суммы**: от копеек до миллионов, валюты
- **Реквизиты**: БИК, корр.счета, КПП

### 5. ТРАНСПОРТ
- **Госномера**: легковые, грузовые, мотоциклы, региональные коды {regional_focus}
- **VIN номера**: разные производители
- **Номера прицепов, полуприцепов**

### 6. СПЕЦИФИКА СФЕРЫ "{business_sphere}"
{sphere_specific_data}

### 7. КОНТЕКСТНЫЕ ПД
- **Семья**: родственники, их имена, возраст, профессии
- **Работа**: должности, компании, стаж, зарплаты
- **Образование**: школы, вузы, курсы, специальности
- **Медицина**: диагнозы, лекарства, врачи, клиники
- **Хобби**: спортивные секции, клубы, тренеры

### 8. РЕГИОНАЛЬНЫЕ ОСОБЕННОСТИ {regional_focus}
{regional_specific_data}

## КАЧЕСТВО ТРАНСКРИБАЦИИ ("{transcription_quality}")
{transcription_quality_details}

## СТИЛИ ОБЩЕНИЯ ("{communication_style}")
{communication_style_details}

## ЛОЖНЫЕ СРАБАТЫВАНИЯ ({false_positive_percentage}%)
Включить данные, похожие на ПД, но таковыми не являющиеся:
- **Номера моделей**: "iPhone 14 Pro Max", "BMW X5", "Samsung Galaxy"
- **Коды товаров**: артикулы, штрихкоды, серийные номера
- **Исторические даты**: "война 1812 года", "революция 1917"
- **Вымышленные персонажи**: герои книг, фильмов, игр
- **Адреса в играх/фильмах**: "как в GTA", "адрес из фильма"
- **Технические коды**: MAC-адреса, IP из локальных сетей

## ФОРМАТ ВЫВОДА
ВАЖНО! Выводи ТОЛЬКО JSON массив диалогов, никакого дополнительного текста!

Для каждого диалога используй такой формат:
```json
{{
  "text": "Полный текст диалога с репликами покупателя и продавца",
  "entities": [
    {{
      "start": 45,
      "end": 67,
      "type": "PERSON",
      "text": "Иван Петрович Сидоров"
    }},
    {{
      "start": 120,
      "end": 135,
      "type": "PHONE", 
      "text": "+7 916 123 45 67"
    }}
  ],
  "has_pd": true,
  "description": "Краткое описание содержания диалога",
  "id": 1
}}
```

## ТИПЫ СУЩНОСТЕЙ ДЛЯ РАЗМЕТКИ
- `PERSON` - ФИО, имена людей
- `PHONE` - телефонные номера
- `EMAIL` - адреса электронной почты
- `AGE` - возраст
- `ADDRESS` - адреса проживания/доставки
- `PASSPORT` - паспортные данные
- `SNILS` - номера СНИЛС
- `INN` - ИНН физлиц и юрлиц
- `BANK_CARD` - номера банковских карт
- `BANK_ACCOUNT` - банковские реквизиты (БИК, корр.счета)
- `CAR_NUMBER` - автомобильные номера
- `VIN_NUMBER` - VIN номера автомобилей
- `DRIVER_LICENSE` - номера водительских удостоверений
- `ORGANIZATION` - названия организаций
- `POSITION` - должности
- `EDUCATION` - учебные заведения
- `FAMILY` - семейные связи
- `MEDICAL` - медицинская информация
- `USERNAME` - логины, никнеймы
- `IP_ADDRESS` - IP адреса
- `LOCATION` - географические названия
- `BIRTHDAY` - даты рождения
- `FALSE_POSITIVE` - ложные срабатывания

## ВАЖНЫЕ ТРЕБОВАНИЯ
- Все диалоги строго на русском языке!
- Естественная разговорная речь с региональными особенностями {regional_focus}
- Реалистичные сценарии для сферы {business_sphere}
- Максимальное разнообразие способов упоминания ПД
- Правильные индексы start/end для каждой сущности
- Разные длины диалогов (от коротких до развернутых)
- Включение типичных ошибок транскрибации уровня "{transcription_quality}"
- Обязательно включай персональные данные в {pd_percentage} процентов реплик и заполняй массив "entities" с координатами start/end.

Ответь ТОЛЬКО JSON массивом из {total_dialogs} диалогов!
"""

# Специфичные данные для сфер деятельности
SPHERE_SPECIFIC_DATA = {
    "автомобили": """
- **Технические данные**: пробег, год выпуска, мощность двигателя
- **Документы**: СТС, ПТС, страховки ОСАГО/КАСКО
- **Идентификаторы**: VIN номера, госномера, номера двигателя
- **Характеристики**: марка, модель, цвет, комплектация
""",
    "недвижимость": """
- **Кадастровые номера**: земельных участков, квартир
- **Характеристики**: площадь, этаж, количество комнат
- **Адреса**: точные адреса объектов, ориентиры
- **Документы**: договоры, выписки из ЕГРН
""",
    "медицина": """
- **Медицинские карты**: номера карт, полисы ОМС
- **Персональные данные**: диагнозы, анализы, группа крови
- **Врачи**: ФИО врачей, специализация, клиники
- **Лекарства**: назначения, дозировки, противопоказания
""",
    "финансы": """
- **Банковские данные**: номера счетов, карт, БИК банков
- **Суммы**: кредиты, депозиты, переводы
- **Документы**: договоры, справки о доходах
- **Идентификаторы**: номера договоров, заявок
""",
    "образование": """
- **Учебные заведения**: школы, вузы, их адреса
- **Документы**: студенческие билеты, дипломы, аттестаты
- **Персоналии**: преподаватели, однокурсники
- **Оценки**: баллы ЕГЭ, средний балл, стипендии
""",
    "розничная торговля": """
- **Товары**: артикулы, серийные номера, штрихкоды
- **Заказы**: номера заказов, чеки, бонусные карты
- **Доставка**: адреса доставки, курьеры
- **Платежи**: способы оплаты, скидки, промокоды
""",
    "услуги": """
- **Заявки**: номера заявок, даты обращений
- **Исполнители**: мастера, специалисты, их контакты
- **Адреса**: места оказания услуг
- **Графики**: время работы, записи на прием
""",
    "техподдержка": """
- **Технические данные**: логины, пароли, IP адреса
- **Устройства**: серийные номера, MAC адреса
- **Обращения**: номера тикетов, описания проблем
- **Решения**: инструкции, коды ошибок
"""
}

# Детали качества транскрибации
TRANSCRIPTION_QUALITY_DETAILS = {
    "отличное": """
- **Четкая речь**: все слова распознаны правильно
- **Правильная пунктуация**: запятые, точки на месте
- **Без ошибок**: нет пропусков или искажений
- **Структурированность**: четкое разделение реплик
""",
    "среднее": """
- **Мелкие ошибки**: 1-2 неточности на предложение
- **Пропущенные знаки**: отсутствие некоторых запятых
- **Неточности**: "говорит" → "говорил", "было" → "была" 
- **Слипшиеся слова**: "потому что" → "потомучто"
""",
    "плохое": """
- **Серьезные ошибки**: искажение смысла фраз
- **Пропуски слов**: "я хочу купить" → "хочу купить"
- **Неправильные слова**: "телефон" → "телевизор"
- **Отсутствие пунктуации**: сплошной текст без точек
- **Числовые ошибки**: "восемь" → "восьми", "пять" → "пятьдесят"
"""
}

# Детали стилей общения  
COMMUNICATION_STYLE_DETAILS = {
    "официальный": """
- **Обращения**: "Здравствуйте", "Будьте добры", "Благодарю"
- **Формулировки**: "Меня зовут Иван Иванович", "Могли бы Вы..."
- **Структура**: четкое изложение, без сленга
- **Титулы**: "господин", "госпожа", должности
""",
    "разговорный": """
- **Обращения**: "Привет", "Слушай", "Ну что"
- **Сокращения**: "мобилка", "мейл", "норм", "ок"
- **Междометия**: "ну", "вот", "короче", "типа"
- **Неформальность**: "Я Ваня", "давай на ты"
""",
    "смешанный": """
- **Переходы**: начало официально, потом расслабление
- **Ситуативность**: формально при проблемах, просто при рутине
- **Адаптация**: подстройка под собеседника
- **Гибкость**: "Здравствуйте... а, привет, это ты!"
"""
}

# Региональные особенности
REGIONAL_DATA = {
    "Москва": {
        "vocabulary": ["метро", "МКАД", "центр", "спальный район", "вылетные", "замкадье"],
        "features": ["метро Сокольники", "Красная площадь", "Садовое кольцо", "Театральная площадь"],
        "phone_codes": ["495", "499", "903", "905", "916", "926"]
    },
    "Санкт-Петербург": {
        "vocabulary": ["Питер", "Невский", "каналы", "разводные мосты", "белые ночи", "коммуналка"],
        "features": ["Дворцовая площадь", "Исаакиевский собор", "Петропавловская крепость", "Эрмитаж"],
        "phone_codes": ["812", "921", "922", "951", "952"]
    },
    "Новосибирск": {
        "vocabulary": ["Академгородок", "левый берег", "правый берег", "Обь", "наукоград"],
        "features": ["Красный проспект", "Оперный театр", "Академгородок", "река Обь"],
        "phone_codes": ["383", "913", "923", "933", "952"]
    },
    "Екатеринбург": {
        "vocabulary": ["Урал", "центр", "ЖБИ", "Химмаш", "Эльмаш"],
        "features": ["площадь 1905 года", "Храм на Крови", "Высоцкий", "Плотинка"],
        "phone_codes": ["343", "902", "904", "912", "950"]
    }
}

RULES_PREFIX = """
## ОБЯЗАТЕЛЬНЫЕ ПРАВИЛА (прочитай ПЕРВЫМ)
1. Ответ ТОЛЬКО валидный JSON массив.
2. В _каждом_ диалоге ВСЕ персональные данные из текста должны быть размечены в массиве \"entities\" с корректными индексами start/end.
3. Если пропущена хотя бы одна сущность – ответ аннулируется, оплата не производится.
4. Не добавляй пояснений, комментариев или markdown.
"""

def format_prompt(config: dict) -> str:
    """
    Форматирует промпт с переданными параметрами
    
    Args:
        config: Словарь с параметрами генерации
        
    Returns:
        Отформатированный промпт
    """
    # Вычисляем производные значения
    total_dialogs = config.get("total_dialogs", 25)
    pd_percentage = config.get("pd_percentage", 75)
    false_positive_percentage = config.get("false_positive_percentage", 15)
    
    no_pd_percentage = 100 - pd_percentage
    pd_count = int(total_dialogs * pd_percentage / 100)
    no_pd_count = total_dialogs - pd_count
    
    # Данные по сфере и региону
    business_sphere = config.get("business_sphere", "розничная торговля")
    regional_focus = config.get("regional_focus", "Москва")
    
    sphere_data = SPHERE_SPECIFIC_DATA.get(business_sphere, "")
    regional_data = REGIONAL_DATA.get(regional_focus, REGIONAL_DATA["Москва"])
    regional_specific_data = f"Особенности региона {regional_focus}: {', '.join(regional_data['features'])}"
    
    # Детали качества и стиля
    transcription_quality = config.get("transcription_quality", "среднее")
    communication_style = config.get("communication_style", "смешанный")
    
    transcription_details = TRANSCRIPTION_QUALITY_DETAILS.get(transcription_quality, "")
    communication_details = COMMUNICATION_STYLE_DETAILS.get(communication_style, "")
    
    return RULES_PREFIX + "\n" + MAIN_PROMPT_TEMPLATE.format(
        total_dialogs=total_dialogs,
        business_sphere=business_sphere,
        regional_focus=regional_focus,
        transcription_quality=transcription_quality,
        communication_style=communication_style,
        pd_percentage=pd_percentage,
        no_pd_percentage=no_pd_percentage,
        pd_count=pd_count,
        no_pd_count=no_pd_count,
        false_positive_percentage=false_positive_percentage,
        sphere_specific_data=sphere_data,
        regional_specific_data=regional_specific_data,
        transcription_quality_details=transcription_details,
        communication_style_details=communication_details
    ) 